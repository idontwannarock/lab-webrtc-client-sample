# WebRTC è¦–è¨ŠèŠå¤©å®¤

ä¸€å€‹åŸºæ–¼ Janus Gateway çš„å¤šäººè¦–è¨ŠèŠå¤©å®¤æ‡‰ç”¨ç¨‹å¼ï¼Œæ”¯æ´é«˜å“è³ªéŸ³è¦–è¨Šé€šè©±å’Œå³æ™‚æ–‡å­—èŠå¤©ã€‚

## åŠŸèƒ½ç‰¹è‰²

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¥ **å¤šäººè¦–è¨Šé€šè©±** - æ”¯æ´ 20-50 äººåŒæ™‚åœ¨ç·šè¦–è¨Šé€šè©±
- ğŸµ **é«˜å“è³ªéŸ³è¨Š** - ä½å»¶é²éŸ³è¨Šå‚³è¼¸ (< 200ms)
- ğŸ’¬ **å³æ™‚æ–‡å­—èŠå¤©** - æˆ¿é–“å…§å³æ™‚æ–‡å­—è¨Šæ¯äº¤æµ
- ğŸ”§ **åª’é«”æ§åˆ¶** - éœéŸ³/å–æ¶ˆéœéŸ³ã€é–‹/é—œæ”å½±æ©ŸåŠŸèƒ½
- ğŸ‘¥ **ç”¨æˆ¶ç®¡ç†** - å‹•æ…‹ç”¨æˆ¶åŠ å…¥/é›¢é–‹ï¼Œå¯¦æ™‚ç”¨æˆ¶è¨ˆæ•¸
- ğŸ“± **éŸ¿æ‡‰å¼è¨­è¨ˆ** - é©é…æ¡Œé¢å’Œè¡Œå‹•è£ç½®

### æŠ€è¡“ç‰¹è‰²
- âš¡ **SFU æ¶æ§‹** - ä½¿ç”¨ Selective Forwarding Unit å„ªåŒ–æ€§èƒ½
- ğŸ”„ **å‹•æ…‹å“è³ªèª¿æ•´** - æ ¹æ“šç¶²è·¯ç‹€æ³è‡ªå‹•èª¿æ•´è¦–è¨Šå“è³ª
- ğŸ›¡ï¸ **è¨Šæ¯å»é‡æ©Ÿåˆ¶** - ä½¿ç”¨ UUID v7 ç¢ºä¿èŠå¤©è¨Šæ¯å¯é å‚³é
- ğŸ” **åˆ†ç´šæ—¥èªŒç³»çµ±** - INFO/DEBUG/ERROR å¤šå±¤ç´šæ—¥èªŒè¨˜éŒ„

## ç³»çµ±æ¶æ§‹

```
[ç”¨æˆ¶A] â†â†’ [Janus Gateway SFU] â†â†’ [ç”¨æˆ¶B]
[ç”¨æˆ¶C] â†â†’      (åª’é«”è½‰ç™¼)      â†â†’ [ç”¨æˆ¶D]
                     |
                [WebSocket ä¿¡ä»¤]
```

### æ¶æ§‹å„ªå‹¢
- **é€£æ¥ç°¡åŒ–**: æ¯ç”¨æˆ¶åƒ…éœ€ä¸€å€‹ä¸Šè¡Œå’Œä¸‹è¡Œé€£æ¥åˆ° SFU
- **è³‡æºå„ªåŒ–**: é™ä½å®¢æˆ¶ç«¯ CPU å’Œè¨˜æ†¶é«”æ¶ˆè€—
- **ç¶²è·¯æ•ˆç‡**: æ¸›å°‘æ•´é«”ç¶²è·¯æµé‡å’Œå»¶é²
- **å¯æ“´å±•æ€§**: æ”¯æ´å¤§è¦æ¨¡ä½µç™¼ç”¨æˆ¶

## å¿«é€Ÿé–‹å§‹

### å‰ç½®è¦æ±‚
- **Janus Gateway ä¼ºæœå™¨** (å·²é…ç½® VideoRoom æ’ä»¶)
- **ç¾ä»£ç€è¦½å™¨** (Chrome 60+, Firefox 55+, Safari 12+)
- **HTTPS ç’°å¢ƒ** (æ”å½±æ©Ÿæ¬Šé™è¦æ±‚)
- **Docker & Docker Compose** (æ¨è–¦ï¼Œç”¨æ–¼å¿«é€Ÿå•Ÿå‹• Janus Gateway)

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Docker (æ¨è–¦)

1. **å…‹éš†å°ˆæ¡ˆ**
   ```bash
   git clone <repository-url>
   cd lab-webrtc-client-sample
   ```

2. **å•Ÿå‹• Janus Gateway æœå‹™**
   ```bash
   # ä½¿ç”¨ Docker Compose å•Ÿå‹• Janus Gateway
   docker-compose up -d janus
   
   # æª¢æŸ¥æœå‹™ç‹€æ…‹
   docker-compose ps
   ```

3. **å•Ÿå‹•å®¢æˆ¶ç«¯æ‡‰ç”¨**
   ```bash
   # ä½¿ç”¨ Docker å•Ÿå‹•éœæ…‹ç¶²é æœå‹™å™¨
   docker-compose up -d web
   
   # æˆ–æ‰‹å‹•å•Ÿå‹• HTTP ä¼ºæœå™¨
   python -m http.server 8080
   ```

4. **é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼**
   - ç€è¦½å™¨é–‹å•Ÿ `http://localhost:8080`
   - å…è¨±æ”å½±æ©Ÿå’Œéº¥å…‹é¢¨æ¬Šé™
   - è¼¸å…¥æˆ¿é–“ ID ä¸¦åŠ å…¥æˆ¿é–“

### æ–¹æ³•äºŒï¼šæ‰‹å‹•å®‰è£ Janus Gateway

å¦‚æœæ‚¨åå¥½æ‰‹å‹•å®‰è£ï¼Œè«‹åƒè€ƒ [CONTRIBUTING.md](CONTRIBUTING.md) ä¸­çš„è©³ç´°èªªæ˜ã€‚

#### å¿«é€Ÿæ‰‹å‹•è¨­ç½®
1. **å®‰è£ Janus Gateway**
   ```bash
   # Ubuntu/Debian
   sudo apt-get update
   sudo apt-get install janus
   
   # æˆ–å¾æºç¢¼ç·¨è­¯ (è©³è¦‹å®˜æ–¹æ–‡ä»¶)
   ```

2. **é…ç½® VideoRoom æ’ä»¶**
   - ç¢ºä¿ Janus Gateway é‹è¡Œåœ¨ `localhost:8188`
   - æˆ–ä¿®æ”¹ `index.html` ä¸­çš„ä¼ºæœå™¨åœ°å€ (ç¬¬ 401 è¡Œå’Œ 242 è¡Œ)

3. **å•Ÿå‹•æœå‹™**
   ```bash
   # å•Ÿå‹• Janus Gateway
   janus
   
   # å•Ÿå‹•å®¢æˆ¶ç«¯ HTTP ä¼ºæœå™¨
   python -m http.server 8080
   ```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬æ“ä½œ
1. **åŠ å…¥æˆ¿é–“**: è¼¸å…¥æˆ¿é–“ ID (é è¨­: 1234)ï¼Œé»æ“Šã€ŒåŠ å…¥æˆ¿é–“ã€
2. **åª’é«”æ§åˆ¶**: ä½¿ç”¨ã€ŒéœéŸ³ã€ã€ã€Œé—œé–‰è¦–è¨Šã€æŒ‰éˆ•æ§åˆ¶æœ¬åœ°åª’é«”
3. **æ–‡å­—èŠå¤©**: åœ¨å³å´èŠå¤©å€åŸŸè¼¸å…¥è¨Šæ¯ï¼ŒæŒ‰ Enter ç™¼é€
4. **é›¢é–‹æˆ¿é–“**: é»æ“Šã€Œé›¢é–‹æˆ¿é–“ã€çµæŸé€šè©±

### æˆ¿é–“ç®¡ç†
- **æˆ¿é–“ 1234**: é è¨­æˆ¿é–“ï¼Œè¨­æœ‰ç®¡ç†å“¡å¯†ç¢¼ ("adminpwd")
- **å…¶ä»–æˆ¿é–“**: å¯ä½¿ç”¨ä»»æ„æ•¸å­— ID å‰µå»ºæ–°æˆ¿é–“
- **ç”¨æˆ¶é¡¯ç¤º**: ç³»çµ±è‡ªå‹•ç”Ÿæˆç”¨æˆ¶åç¨± (æ ¼å¼: ç”¨æˆ¶_XXX)

## æŠ€è¡“è¦æ ¼

### å‰ç«¯æŠ€è¡“
- **HTML5** - çµæ§‹å’Œæ¨£å¼
- **Vanilla JavaScript** - æ ¸å¿ƒé‚è¼¯
- **WebRTC API** - åª’é«”è™•ç†
- **WebSocket** - ä¿¡ä»¤é€šè¨Š

### å¾Œç«¯æœå‹™
- **Janus Gateway** - SFU åª’é«”ä¼ºæœå™¨
- **VideoRoom Plugin** - è¦–è¨ŠèŠå¤©å®¤åŠŸèƒ½
- **WebRTC Adapter** - ç€è¦½å™¨ç›¸å®¹æ€§

### èŠå¤©ç³»çµ±
- **ä¸»è¦æ–¹æ¡ˆ**: VideoRoom display å±¬æ€§æ›´æ–°æ©Ÿåˆ¶
- **å‚™ç”¨æ–¹æ¡ˆ**: BroadcastChannel + localStorage
- **è¨Šæ¯æ ¼å¼**: JSON çµæ§‹åŒ–æ•¸æ“š
- **å»é‡æ©Ÿåˆ¶**: UUID v7 + Map è¨˜éŒ„

## å°ˆæ¡ˆçµæ§‹

```
lab-webrtc-client-sample/
â”œâ”€â”€ index.html          # ä¸»æ‡‰ç”¨ç¨‹åº
â”œâ”€â”€ janus.js           # Janus Gateway å®¢æˆ¶ç«¯åº«
â”œâ”€â”€ requirement.md     # éœ€æ±‚åˆ†æèˆ‡å¯¦ç¾ç‹€æ…‹
â”œâ”€â”€ README.md          # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â””â”€â”€ CONTRIBUTING.md    # è²¢ç»æŒ‡å—
```

## Docker é…ç½®èªªæ˜

### æœå‹™æ¶æ§‹
æœ¬å°ˆæ¡ˆæä¾›å®Œæ•´çš„ Docker ç’°å¢ƒï¼ŒåŒ…å«ï¼š
- **Janus Gateway**: SFU åª’é«”ä¼ºæœå™¨ (ç«¯å£: 8188, 8081)
- **Web Server**: éœæ…‹ç¶²é æœå‹™å™¨ (ç«¯å£: 8080)
- **Admin Interface**: Janus ç®¡ç†ç•Œé¢ (ç«¯å£: 7088)

### ç’°å¢ƒè®Šæ•¸
```yaml
# docker-compose.yml ä¸­å¯é…ç½®çš„ç’°å¢ƒè®Šæ•¸
JANUS_WS_PORT=8188          # WebSocket ç«¯å£
JANUS_HTTP_PORT=8081        # HTTP ç«¯å£
JANUS_ADMIN_PORT=7088       # ç®¡ç†ç•Œé¢ç«¯å£
WEB_PORT=8080               # å®¢æˆ¶ç«¯ç¶²é ç«¯å£
```

### å®¢æˆ¶ç«¯é…ç½®
```javascript
// index.html ä¸­çš„ Janus Gateway é…ç½®
server: 'ws://localhost:8188'              // WebSocket é€£æ¥åœ°å€
src: 'http://localhost:8081/janus.js'      // Janus å®¢æˆ¶ç«¯åº«åœ°å€
```

### è‡ªå®šç¾©é…ç½®
å¦‚éœ€ä¿®æ”¹æœå‹™å™¨åœ°å€ï¼Œè«‹æ›´æ–° `index.html` ä¸­çš„ä»¥ä¸‹è¡Œï¼š
- **ç¬¬ 401 è¡Œ**: WebSocket é€£æ¥åœ°å€
- **ç¬¬ 242 è¡Œ**: Janus JavaScript åº«åœ°å€

```javascript
// ä¿®æ”¹ç‚ºæ‚¨çš„ Janus Gateway åœ°å€
server: 'ws://your-janus-server:8188'
src: 'http://your-janus-server:8081/janus.js'
```

### Janus Gateway é…ç½®æ–‡ä»¶

Docker ç’°å¢ƒæœƒè‡ªå‹•é…ç½®ä»¥ä¸‹ Janus è¨­å®šï¼š

```ini
# janus.jcfg - ä¸»è¦é…ç½®
[general]
configs_folder = /opt/janus/etc/janus
plugins_folder = /opt/janus/lib/janus/plugins
transports_folder = /opt/janus/lib/janus/transports

[nat]
ice_enforce_list = "eth0"
ice_ignore_list = "vmnet"

[media]
rtp_port_range = "20000-40000"
```

```ini
# janus.transport.websockets.jcfg - WebSocket å‚³è¼¸
[general]
ws = true
ws_port = 8188
wss = false

[admin]
admin_ws = true
admin_ws_port = 7188
```

### åª’é«”è¨­å®š
```javascript
// ç”¨æˆ¶åª’é«”è«‹æ±‚
navigator.mediaDevices.getUserMedia({
    video: true,
    audio: true
})

// æˆ¿é–“é…ç½®
{
    publishers: 50,         // æœ€å¤§ç™¼å¸ƒè€…æ•¸é‡
    is_private: false,      // å…¬é–‹æˆ¿é–“
    description: `æˆ¿é–“ ${roomId}`
}
```


## æ•…éšœæ’é™¤

### Docker ç›¸é—œå•é¡Œ

1. **Docker æœå‹™å•Ÿå‹•å¤±æ•—**
   ```bash
   # æª¢æŸ¥ Docker æœå‹™ç‹€æ…‹
   docker-compose logs janus
   
   # é‡æ–°å•Ÿå‹•æœå‹™
   docker-compose down
   docker-compose up -d
   ```

2. **ç«¯å£è¡çª**
   ```bash
   # æª¢æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :8188
   
   # ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
   ports:
     - "8189:8188"  # æ”¹ç”¨å…¶ä»–ç«¯å£
   ```

3. **Janus Gateway é€£æ¥å•é¡Œ**
   ```bash
   # é€²å…¥ Janus å®¹å™¨æª¢æŸ¥ç‹€æ…‹
   docker-compose exec janus bash
   
   # æŸ¥çœ‹ Janus æ—¥èªŒ
   docker-compose logs -f janus
   ```

### æ‡‰ç”¨ç¨‹å¼å•é¡Œ

1. **ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨**
   - æª¢æŸ¥ Docker å®¹å™¨æ˜¯å¦æ­£å¸¸é‹è¡Œ: `docker-compose ps`
   - ç¢ºèªé˜²ç«ç‰†è¨­å®šå…è¨±ç›¸é—œç«¯å£
   - é©—è­‰å®¢æˆ¶ç«¯é…ç½®ä¸­çš„ä¼ºæœå™¨åœ°å€

2. **æ”å½±æ©Ÿæ¬Šé™è¢«æ‹’çµ•**
   - ä½¿ç”¨ HTTPS å”å®šæä¾›æœå‹™
   - åœ¨ç€è¦½å™¨è¨­å®šä¸­å…è¨±æ”å½±æ©Ÿæ¬Šé™
   - æª¢æŸ¥ç¡¬é«”æ”å½±æ©Ÿæ˜¯å¦å¯ç”¨

3. **èŠå¤©è¨Šæ¯ä¸é¡¯ç¤º**
   - æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯
   - ç¢ºèªæˆ¿é–“ ID ä¸€è‡´
   - é©—è­‰ VideoRoom display æ›´æ–°æ©Ÿåˆ¶

### æ—¥èªŒåˆ†æ
ç³»çµ±æä¾›åˆ†ç´šæ—¥èªŒè¼¸å‡ºï¼š
- `ERROR` - éŒ¯èª¤è¨Šæ¯
- `WARN` - è­¦å‘Šè¨Šæ¯  
- `INFO` - ä¸€èˆ¬è³‡è¨Š
- `DEBUG` - èª¿è©¦è¨Šæ¯

## æ•ˆèƒ½å„ªåŒ–

### æœ€ä½³å¯¦è¸
- ä½¿ç”¨é©ç•¶çš„è¦–è¨Šè§£æåº¦ (720p æ¨è–¦)
- ç›£æ§ç¶²è·¯é »å¯¬ä½¿ç”¨æƒ…æ³
- å®šæœŸæ¸…ç†éæœŸçš„èŠå¤©è¨Šæ¯è¨˜éŒ„
- é©æ™‚èª¿æ•´æ—¥èªŒç­‰ç´šæ¸›å°‘è¼¸å‡º

### ç³»çµ±é™åˆ¶
- **å–®ä¸€æˆ¿é–“å»ºè­°ä¸Šé™**: 50 äºº
- **è¦–è¨Šå»¶é²ç›®æ¨™**: < 200ms
- **èŠå¤©è¨Šæ¯ä¿ç•™æ™‚é–“**: 5 åˆ†é˜
- **Docker è³‡æºéœ€æ±‚**: 
  - æœ€å°è¨˜æ†¶é«”: 512MB
  - æ¨è–¦è¨˜æ†¶é«”: 2GB+
  - CPU: 2 æ ¸å¿ƒä»¥ä¸Šæ¨è–¦

## è²¢ç»

æ­¡è¿è²¢ç»ä»£ç¢¼ã€å ±å‘Šå•é¡Œæˆ–æå‡ºå»ºè­°ï¼è«‹æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è©³ç´°çš„è²¢ç»æŒ‡å—ã€‚

## æˆæ¬Šè²æ˜

æœ¬å°ˆæ¡ˆç‚ºå­¸ç¿’å’Œç¤ºç¯„ç”¨é€”ï¼Œè«‹éµå®ˆç›¸é—œé–‹æºè»Ÿé«”æˆæ¬Šæ¢æ¬¾ã€‚

## æ”¯æ´èˆ‡åé¥‹

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹é€šéä»¥ä¸‹æ–¹å¼è¯ç¹«ï¼š
- æäº¤ [GitHub Issue](https://github.com/your-repo/issues)
- æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) é–‹ç™¼æŒ‡å—
- åƒè€ƒ [Janus Gateway å®˜æ–¹æ–‡ä»¶](https://janus.conf.meetecho.com/)

---

**æ³¨æ„**: æ­¤å°ˆæ¡ˆéœ€è¦é…ç½® Janus Gateway åª’é«”ä¼ºæœå™¨æ‰èƒ½æ­£å¸¸é‹è¡Œã€‚è«‹ç¢ºä¿æ‚¨çš„ç¶²è·¯ç’°å¢ƒæ”¯æ´ WebRTC é€£æ¥ã€‚